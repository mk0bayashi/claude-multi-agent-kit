# タスクルーティング判定リファレンス

ユーザーがスラッシュコマンドなしで自然言語タスクを投げた場合、
Conductorはこのリファレンスに基づき最適な実行方法を判定・推薦する。

## 判定フロー

```
ユーザー入力（自然言語）
    ↓
[Step 1] タスク分類
    ├─ 要件が不明瞭 → 質問で明確化してから再判定
    ├─ 単一エージェントで完結 → 直接委任（パターン不要）
    └─ マルチエージェントパターンが必要 → Step 2 へ
    ↓
[Step 2] パターン選定（判定マトリクス参照）
    ↓
[Step 3] Subagent / Agent Teams 選択（該当パターンのみ）
    ↓
[Step 4] AskUserQuestion で推薦を提示
    ↓
[Step 5] ユーザー確認後、Skill ツールで該当コマンドを実行
```

## Step 1: タスク分類

### (A) 単一エージェントで完結するケース

以下に該当する場合はパターンを使わず、該当エージェントに直接委任する。

| タスク特性 | 委任先エージェント | 例 |
|---|---|---|
| SNS投稿の作成のみ | social-media-writer | 「この記事をTwitter投稿にして」 |
| 契約書/NDAのレビューのみ | legal-reviewer | 「この契約書をチェックして」 |
| 財務分析・仕訳のみ | finance-analyst | 「この仕訳を確認して」 |
| CSV/データ分析のみ | data-analyst | 「このCSVのKPIを算出して」 |
| LP/セールスコピーのリライトのみ | female-copywriter | 「このLPを女性向けにリライトして」 |
| マーケティング施策の企画のみ | marketing-strategist | 「メールシーケンスを設計して」 |

**判定基準**: タスクが単一の専門領域で完結し、調査→加工→品質チェックの多段階処理が不要な場合。

### (B) マルチエージェントパターンが必要なケース

複数のエージェントによる協調作業が必要 → Step 2 へ進む。

### (C) 要件が不明瞭なケース

以下のような場合は、先にユーザーに質問して要件を明確化する:
- タスクの範囲が広すぎる（例: 「マーケティングを改善して」）
- 成果物の形式が不明（例: 「AIについてまとめて」→ レポート？SNS投稿？提案書？）
- 対象が特定されていない（例: 「競合を調べて」→ どの競合？何を比較？）

## Step 2: パターン選定マトリクス

| タスク特性・キーワード | 推薦パターン | コマンド |
|---|---|---|
| 市場調査、業界分析、技術動向、トレンド調査 | P1: リサーチ・パイプライン | `pattern-research-pipeline` |
| 既存文書のレビュー、品質チェック、多角的評価 | P2: 多視点レビュー | `pattern-multi-review` |
| 1テーマ→複数形式（ブログ+SNS+メール+プレスリリース等） | P3: コンテンツ制作ファクトリー | `pattern-content-factory` |
| 競合比較、ベンチマーク、複数企業の分析 | P4: 競合情報マトリクス | `pattern-competitor-matrix` |
| 仮説検証、「〜は本当か？」、データで裏付け | P5: 仮説構築→検証ループ | `pattern-hypothesis-loop` |
| 提案の反応予測、承認獲得の事前検討、関係者の立場分析 | P6: ステークホルダーSim | `pattern-stakeholder-sim` |
| 高品質ドキュメント作成、段階的に磨く、練り上げ | P7: 段階的精緻化 | `pattern-progressive-refine` |
| 週次/日次レポート、ニュースまとめ、定期インテリジェンス | P8: 自動ダイジェスト | `pattern-weekly-digest` |
| クライアント向け提案書、企画書、ビジネスプラン | P9: 提案書ビルダー | `pattern-proposal-builder` |
| 翻訳、ローカライズ、多市場/多読者適応 | P10: ローカライズ | `pattern-localize` |
| 新規事業アイデア、ブレスト、コンセプト検討 | P11: アイデアワークショップ | `pattern-idea-workshop` |

### 複数パターンが候補になる場合の優先ルール

- 「調査してレポートにまとめて」→ P1（調査が主目的）
- 「調査して提案書にして」→ P9（提案書が最終成果物）
- 「競合を調べてレポートにして」→ P4（競合比較が主目的）
- 「このレポートをブログとSNSにして」→ P3（既存コンテンツの多形式展開）
- 「このレポートの品質をチェックして」→ P2（既存成果物のレビュー）
- 「新規事業のアイデアを出して提案書にまとめて」→ P11（アイデア発想が先、提案書は最終フェーズに含まれる）

## Step 3: Subagent / Agent Teams 選択

Teams版が利用可能なのは P2 / P4 / P5 / P6 / P11 の5パターンのみ。

### デフォルト: Subagent版を推薦

安定性が高く、コストが低い。多くの場合これで十分。

### Agent Teams版を推薦する条件

| パターン | Teams版を推薦する状況 |
|---|---|
| P2 多視点レビュー | 「レビュワー同士で議論させて」「反論も含めて」 |
| P4 競合マトリクス | 競合間の相互影響を分析したい、リアルタイム共有が重要 |
| P5 仮説検証 | 仮説が複雑、検証過程で仮説の動的修正が必要 |
| P6 ステークホルダーSim | 「実際に議論させて」「対立する立場の交渉を見たい」 |
| P11 アイデアワークショップ | 「専門家同士で掛け合わせて」「相互触発させて」 |

## Step 4: AskUserQuestion による推薦提示

### 提示フォーマット

ユーザーへの推薦は AskUserQuestion を使い、以下の構造で提示する:

- **question**: タスク要約 + 推薦パターン名 + 簡潔な理由
- **header**: "実行方法"（12文字以内）
- **options**: 2〜4個
  - 第1選択肢: 推薦パターン（ラベルに「(推奨)」を付記）
  - 第2選択肢: 代替パターンまたはTeams版
  - 第3選択肢（任意）: 単一エージェントでの簡易実行
  - 「その他」は自動で表示される

### 推薦説明に含めるべき情報

- なぜそのパターンが最適か（1文）
- そのパターンで何が得られるか（成果物の種類）
- 代替パターンとの違い（1文）

## Step 5: 実行

ユーザーの選択に基づき、Skill ツールで該当コマンドを実行する。

```
Skill(skill: "{選択されたコマンド名}", args: "{ユーザーの元のタスク記述}")
```

## 補足: スラッシュコマンド直接指定時の動作

ユーザーが `/pattern-*` や `/team-*` を明示的に指定した場合は、
このルーティングプロセスをスキップし、指定されたコマンドを即座に実行する。
